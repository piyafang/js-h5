//20150429V2
!function(e){function t(){i(E,b)}function i(e,t){return cQuery.isEmptyObject(e)?!1:void l(t,{cityId:document.getElementById(e.cityId).value,cityName:document.getElementById(e.cityName).value,cityPY:document.getElementById(e.cityPY).value,checkIn:document.getElementById(e.checkIn).value,checkOut:document.getElementById(e.checkOut).value,hotelLevel:document.getElementById(e.hotellevel).value})}function n(e,t){document.getElementById(e.cityId).value=t.cityId,document.getElementById(e.cityName).value=t.cityName,document.getElementById(e.cityPY).value=t.cityPY,document.getElementById(e.checkIn).value=""===t.checkIn?o():r(t.checkIn)?o():t.checkIn,document.getElementById(e.checkOut).value=""===t.checkOut?s():r(t.checkOut)?s():t.checkOut,t.hotellevel>0&&(document.getElementById(e.hotellevel).value=t.hotellevel)}function o(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}function s(){return o().toDate().addDays(1).toFormatString("yyyy-MM-dd")}function r(e){var t=new Date(e.replace(/\-/g,"/")).getTime(),i=new Date(o().replace(/\-/g,"/")).getTime();return i>=t}function c(e,t){var i={},n=cQuery.cookie.get(e);n=(n?n:"").split("split");for(var o=0,a=n.length;a>o;o++)0==o?i[t.cityId]=unescape(n[o]):1==o?i[t.cityName]=unescape(n[o]):2==o?i[t.cityPY]=unescape(n[o]):3==o?i[t.checkIn]=unescape(n[o]):4==o?i[t.checkOut]=unescape(n[o]):5==o&&(i[t.hotellevel]=unescape(n[o]));return i}function l(e,t){var i=window.location.host.replace(/www\./,"");cQuery.cookie.set(b,null,t.cityId+"split"+t.cityName+"split"+t.cityPY+"split"+t.checkIn+"split"+t.checkOut+"split"+t.hotelLevel,{expires:30,domain:i,path:"/"})}var u={},d=(document.domain.replace(/www/i,"http://hotels"),{srhLoading:"搜索中…",srhLoad:"搜索"});window.userBehaviorKeyWordInfo={searchType:"S",cityId:null,keyword:null},window.__uidc_init=1*new Date,window.parseRawData=function(){};var y=document.getElementById("chinaHotelForm"),h=24192e5,m={cityname:{suggestionB:"支持中文/拼音/简拼输入",suggestion:"<strong>热门城市</strong>（可直接选择城市或输入城市全拼/简拼）"},searchHistory:"搜索历史",addressTab:"省市",hotelPos:{suggestion:"可直接选择地理位置或输入位置关键词",titles:{zone:"商业区",location:"行政区",metro:"地铁线"},showAMap:!1,AMapTitle:"查看商业区地图",all:"全部",subCity:"下辖市/县："},suggestTitle:["名称","机场火车站","位置"],defaultValue:["上海","2","shanghai"]},v={hotel:{city:"请选择酒店所在城市",checkIn:"请选择入住日期",checkOut:"请选择离店日期",dateErr:"日期格式为yyyy-mm-dd",too_early_in:"入住日期不能早于今天",too_early_out:"您选择的离店日期早于/等于入住日期，请重新选择",too_long:"您入住酒店时间超过28天，请分订单提交预订",no_room:"您选择的日期没有房间可供预订!",room_num:"请选择预订房间数"}},p=["中文/拼音"];window.HD_HOTEL_CONFIG&&(HD_HOTEL_CONFIG.addressMessageConfig&&(m=HD_HOTEL_CONFIG.addressMessageConfig),HD_HOTEL_CONFIG.validateMessageConfig&&(v=HD_HOTEL_CONFIG.validateMessageConfig),HD_HOTEL_CONFIG.noticeMessageConfig&&(p=HD_HOTEL_CONFIG.noticeMessageConfig));var g="http://hotels.ctrip.com",_=document.getElementById("solution"),f=_&&_.value;/^FAT/i.test(f)?g="http://hotels.fat2.qa.nt.ctripcorp.com":/^UAT_NT/i.test(f)&&(g="http://hotels.uat.qa.nt.ctripcorp.com"),window.JSONP_POS_RESPONSE="",window.CLICK_DATA_TYPE="",window.CLICK_DATA_VALUE="";var w=function(t){t=t||{};var i=function(e){var t={};if(!e)return t;for(var i=e.split(/@/),n=0;n<i.length;n++){var o=i[n].split("|"),a=o[1];t[a]={pinyin:o[0],keywordClick:o[2],type:o[3]}}return t},n=function(e){var t=new Image;t.src=e,t=null},o=e.extend({KEYWORD_INPIT:"HD_TxtKeyword",URL:"http://hotels.ctrip.com/Domestic/Tool/AjaxImpressionLog.aspx",CITYID_HIDDEN_INPUT:"HD_CityId",STAR_HIDDEN_INPUT:"searchHotelLevelSelect",KEYWORD_HIDDEN_INPUT:"hotelAreaName"},t),a=i(JSONP_POS_RESPONSE),s={},r=document.getElementById(o.KEYWORD_INPIT)?document.getElementById(o.KEYWORD_INPIT).value:"",c=a[r]||{},l=[],u=o.URL;if(s.type=c.type||"",s.keywordclick=c.keywordClick||"",s.url=encodeURIComponent(window.location.href),s.city=document.getElementById(o.CITYID_HIDDEN_INPUT)?document.getElementById(o.CITYID_HIDDEN_INPUT).value:"",s.star=document.getElementById(o.STAR_HIDDEN_INPUT)?document.getElementById(o.STAR_HIDDEN_INPUT).value:"",s.keyword=escape(document.getElementById(o.KEYWORD_HIDDEN_INPUT)?document.getElementById(o.KEYWORD_HIDDEN_INPUT).value:""),s.version="1.0",s.isnewsearch="true",s.ClickSourceType="1",s.ClickDataType=CLICK_DATA_TYPE||"city",s.ClickDataValue=CLICK_DATA_VALUE||document.getElementById("HD_CityId").value,!e.isEmptyObject(s)){for(k in s)l.push(k+"="+s[k]);u+="?"+l.join("&")}n(u)};e.getJsonp=function(){var e=0;return function(t,i){var n="_json"+e++,o=document.getElementsByTagName("head")[0],a=document.createElement("script");a.charset="utf-8",a.src=t+"?callback="+n,o.appendChild(a),window[n]=function(e){i(e),o.removeChild(a),window[n]=null}}}();var I={dataCash:{idFrom1To10:!1,idFrom11To200:!1,idFrom201ToMax:!1,error:!0}},D=!0;u.globalForm={form:document.forms[0],submit:function(e,t){var i=this.form;i.action=e,i.target=t||"_self",i.__VIEWSTATE&&(i.__VIEWSTATE.name="NOVIEWSTATE"),i.submit()}},u.defaultSuggestionInit=function(e){function t(){var e=this;i.each(function(t,i){t[0]==e?(t.addClass("hot_selected"),n[i].style.display=""):(t.removeClass("hot_selected"),n[i].style.display="none")})}var i=e.find(".tab_box li"),n=e.find("div.city_item");i.length&&(i.bind("mousedown",t),t.apply(i[0]))},u.hotelNamePreHtml="",cQuery.highlightKeyword=function(e,t){return t?(t=t.split(/\s+/),t.each(function(t){/[a-zA-Z]/.test(t)||(e=e.replace(new RegExp("("+t+")","gi"),"<span class='b'>$1</span>"))}),e):e},function(e,t){function i(e,t){var i=/\$\{cityId\}/g;setTimeout(function(){e.set("jsonpFilter",t?cQuery.keywordJsonpFilterTpl.replace(i,t||""):void 0),e.set("jsonpSource",t?cQuery.keywordJsonpSourceTpl.replace(i,t||""):void 0)},0)}function n(e){var t=e[0].ownerDocument,i=t.createElement("link");i.type="text/css",i.rel="stylesheet",i.href="http://webresource.c-ctrip.com/styles/common/c_address.css",t.getElementsByTagName("head")[0].appendChild(i)}function o(e,i){var n=i.data.split("|"),o="",a=t("#HD_CityId"),s=a.value();d.value(n[2]||o),"D"!==s.substr(0,1).toUpperCase()&&("District"===n[3]?(a.value("D"+n[2]+"_"+n[4]),t("#HD_CityPy").value(n[7])):(!!n[4]&&a.value(n[4]),!!n[6]&&t("#HD_CityPy").value(n[6]))),f.value(i.value),_.value(n[3]||o);var r=t("#HD_Btn");r[0]&&setTimeout(function(){r.trigger("click")},0)}function s(e){return r(e,16,4)}function r(e,t,i){var n,o,s=0,r={};for(n in e)o=e[n],s+=Math.max(i-o.length,0);for(n in e)o=e[n],a=o.length,o=r[n]=o.slice(0,s?Math.max(i+s,i):i),s&&(s=Math.max(s-Math.max(o.length-i,0),0));return r}function c(e){var t={name:[],district:[],station:[],position:[]},i=w,n="|",o=1,a=0,r=0,c=null;return e.each(function(e){var o=e.data.split(n),a=o[3].toLowerCase(),s=i[a];t[s.view].push(e)}),c=s(t),["name","district","station","position"].each(function(e){var t=c[e]||null;if(t)for(a=0,r=t.length;r>a;a++)t[a].yindex=o++}),c}var l=t.browser.isIE,d=t("#positionId"),_=t("#positionArea"),f=t("#hotelAreaName"),w={hotel:{search:"",view:"name"},district:{search:"district",view:"district"},cityhotelgroup:{search:"g",view:"name"},districthotelgroup:{search:"g",view:"name"},citydistricthotelgroup:{search:"g",view:"name"},cityhotelbrand:{search:"h",view:"name"},districthotelbrand:{search:"h",view:"name"},citydistricthotelbrand:{search:"h",view:"name"},markland:{search:"sl",view:"position"},metrostation:{search:"s",view:"position"},zone:{search:"zone",view:"position"},domesticzone:{search:"zone",view:"position"},sight:{search:"sl",view:"position"},location:{search:"location",view:"position"},metro:{search:"l",view:"position"},airport:{search:"sl",view:"station"},railwaystation:{search:"sl",view:"station"}};e.markerTypeMap=w;var C=function(e){this.init(e),this.initNotice(),this.initAddress(),this.ops.startDate.length&&this.ops.endDate.length&&this.initCalendar(this.ops.startDate,this.ops.endDate),this.ops.checkInDate.length&&this.ops.checkOutDate.length&&this.initCalendar(this.ops.checkInDate,this.ops.checkOutDate),this.initValidate()};e.Help={format:function(e){var t={};for(var i in e)if(t[i]={},-1!=i.search(/[A-Z]/i))for(var n=0;n<e[i].length;n++)t[i][e[i][n].group]?t[i][e[i][n].group].push(e[i][n]):(t[i][e[i][n].group]=[],t[i][e[i][n].group].push(e[i][n]));else for(var n=0;n<e[i].length;n++)t[i][""]?t[i][""].push(e[i][n]):(t[i][""]=[],t[i][""].push(e[i][n]));return t},highlight:function(e,t){for(var i=["\\","^","$",".","*","+","=",":","|","/","(",")","[","]","{","}"],n=0;n<i.length;n++)t=t.replace(i[n],"\\"+i[n]);var o=new RegExp(t,"i");return e.replace(o,"<b>$&</b>")},getScenic:function(e){var t=[];return e.each(function(e){var i=e.data.split("|"),n=ScenicData[i[2]];n&&"District"===i[6]&&(n.data=e.data,t.push(n))}),t},groupCityFilterData:function(e){var t={},i=1,n=0;return e.each(function(e){var i=e.data.split("|"),n=i[6];(t[n]||(t[n]=[])).push(e)}),["City","District","Sight","Location","DomesticZone","Airport","RailwayStation"].each(function(e){if(t[e])for(n=0;n<t[e].length;n++)t[e][n].yindex=i++}),t}},e.setKeywordJsonpUrl=i,function(){var e=t("#HD_Btn");e.bind("click",function(){window.userBehaviorKeyWordInfo.cityId=t("#HD_CityId").value(),window.userBehaviorKeyWordInfo.keyword=t("#HD_TxtKeyword").value(),window.__bfi.push(["_tracklog","SEARCH_AUTOCOMPLET_US",t.stringifyJSON(window.userBehaviorKeyWordInfo)]),window.userBehaviorKeyWordInfo={searchType:"S",cityId:null,keyword:null}})}(),cQuery.groupMarkerData=c,t.extend(C.prototype,{init:function(e){this.ops={city:[],startDate:[],endDate:[],keyword:[],checkInDate:[],checkOutDate:[],offsetPos:5},this.ops=t.extend(this.ops,e)},initValidate:function(){u.formValidator=d.regMod("validate",PluginsVersion.validate)},initKeyword:function(){window.HD_ENV_FOR_TMPL=g;{var e=t("#HD_Btn"),a=this.ops.keyword,s=HD_HOTEL_CONFIG.tmpl.keywordFilter,r=t("#HD_CityId").value();cQuery.config("charset")}cQuery.keywordFilterHighlights={},cQuery.jsonpPosCallback=function(e){var t=e.result,i=a.value();cQuery.keywordFilterHighlights[i]=e.tokens,cQuery.jsonpResponse={key:i,data:"@"+e.result+"@"},JSONP_POS_RESPONSE=t},t.keywordJsonpFilterTpl=g+"/Domestic/Tool/AjaxFindKeywordNew.aspx?cityid=${cityId}&keyword=${key}&callback=cQuery.jsonpPosCallback",t.keywordJsonpSourceTpl=g+"/Domestic/Tool/AjaxGetHotKeyword.aspx?cityid=${cityId}",u.n_keyword=a.regMod("notice",PluginsVersion.notice,{name:"keyword",tips:a[0].getAttribute("_cqnotice"),selClass:"inputSel"}),u.a_keyword=a.regMod("address",PluginsVersion.address,{name:"keyword",source:"@@",isFocusNext:!1,isIframe:l,delay:500,isFilterSelect:!1,isAutoCorrect:!1,offset:5,template:{padVersion:"2.0",filterPageSize:-1,suggestion:HD_HOTEL_CONFIG.tmpl.keywordSuggestion,suggestionIpad:HD_HOTEL_CONFIG.tmpl.keywordSuggestionIPad,suggestionStyle:HD_HOTEL_CONFIG.tmpl.keywordSuggestionStyle,suggestionStyleIpad:HD_HOTEL_CONFIG.tmpl.keywordSuggestionStyleIPad,filter:s,filterStyle:HD_HOTEL_CONFIG.tmpl.keywordFilterStyle,filterIpad:s,filterStyleIpad:HD_HOTEL_CONFIG.tmpl.keywordFilterStyleIPad,suggestionInit:function(e){u.defaultSuggestionInit(e),l&&n(e),e.find(".close").bind("mousedown",function(){a[0].blur()}),e.find('a[data-dopost="T"]').bind("mousedown",function(){var e=this;setTimeout(function(){u.globalForm.submit(e.getAttribute("href"),e.getAttribute("target"))},0)}),window.$isPad&&e.find("#pad_mini_keyboard").bind("click",function(){var e=a[0],t="readonly"!=a[0].getAttribute("readonly");t?(e.setAttribute("readonly","readonly"),this.className="ico_key"):(e.removeAttribute("readonly"),this.className="ico_unkey"),e.blur(),e.select(),e.focus()})}.bind(this),filterInit:function(e){e.find(".close").bind("mousedown",function(){a[0].blur()})}}}),u.a_keyword.method("bind","change",o),u.a_keyword.method("bind","userinput",function(e,i){var n=i.autoCorrectValue,o={searchType:"S",cityId:t("#HD_CityId").value(),keyword:n};return"suggestionMousedown"===i.eventType?(o.searchType="S_X",void(window.userBehaviorKeyWordInfo=o)):"filterMousedown"===i.eventType||"keydown"===i.eventType?(o.searchType="B+S",o.Yindex=i.target&&t(i.target).attr("data-yindex"),o.inputkeyword=i.value,o.fulldata=i.data,void(window.userBehaviorKeyWordInfo=o)):void 0}),r&&i(u.a_keyword,r),a.bind("blur",function(){this.value&&this.value==f.value()||(f.value(this.value),d.value(""),_.value(""))}),u.a_keyword.method("bind","enter",function(){e.trigger("click")})},initAddress:function(){function n(e){var i=e.find(".search_history_box");u.defaultSuggestionInit(e),i.bind(f?"touchend":"mousedown",function(n){var o=n.target||n.srcElement||n.host;if("A"===o.tagName){var a=t.parseJSON(o.getAttribute("data-history"));c.removeClass("inputSel").value(unescape(a.cityname)),t("#HD_CityId").value(a.id),t("#HD_CityPy").value(a.pingying),"false"===a.isoutdate&&(d.value(a.checkin),h.value(a.checkout),d[0].style.backgroundImage="",h[0].style.backgroundImage=""),u.a_city.method("hidden"),e.find("#mini_c_address_close").each(function(e){e[0].click()}),l&&i.html(i.html()),cityChange(void 0,{items:[a.pingying,a.cityname,a.id]})}}),e.find(".close").bind("mousedown",function(e){e.stop(),c[0].blur()})}function o(e){function i(){var t=e.offset(),i=a.offset();o.css(s+r<i.top+300?{top:"",bottom:t.bottom-i.bottom+"px"}:{top:i.top-t.top-1+"px",bottom:""}),o.css("display","block")}var n,o=e.find(".city_scenic_pic"),a=e.find(".item_list_scenic"),s=document.documentElement.scrollTop||document.body.scrollTop,r=window.innerHeight||document.documentElement.clientHeight||document.body.offsetHeight;f?t(e.find(".sug_item")[0]).hasClass("item_list_scenic")?i():o.css("display","none"):(e.find(".close").bind("mousedown",function(e){e.stop(),c[0].blur()}),e.find(".item_list_scenic .city_item").bind("mouseenter",function(t){clearTimeout(n),e.find(".scenic_map_num_hover").removeClass("scenic_map_num_hover");var o=t.target.getAttribute("data");e.find('.city_scenic_pic a[data="'+o+'"] .scenic_map_num').addClass("scenic_map_num_hover"),i()}).bind("mouseleave",function(){n=setTimeout(function(){e.find(".scenic_map_num_hover").removeClass("scenic_map_num_hover"),o.css("display","none")},100)}),e.find(".city_scenic_pic").bind("mouseenter",function(){clearTimeout(n)}),e.find(".city_scenic_pic a[data]").bind("mouseenter",function(i){var n=i.target.getAttribute("data");e.find(".scenic_map_num_hover").removeClass("scenic_map_num_hover"),t(i.target).find(".scenic_map_num").addClass("scenic_map_num_hover"),e.find('.item_list_scenic a[data="'+n+'"]').addClass("hover")}).bind("mouseleave",function(i){t(i.target).find(".scenic_map_num").removeClass("scenic_map_num_hover"),e.find(".city_item.hover").removeClass("hover")}))}function a(){function i(e,i){var n=i.items||[];if(9===n.length){CLICK_DATA_TYPE=n[6],CLICK_DATA_VALUE=n[8];var o=n[6].toLowerCase();"city"!==o&&"district"!==o&&(p.removeClass("inputSel").value(n[4]),p.attr("isFormCity","true"),t("#positionArea").value(o),t("#positionId").value(n[8]),t("#hotelAreaName").value(n[4]))}cityChangeEvent(n[2],n[0])}function a(e,t){var i="",n=0;return t?(n=1,i=t):(n=0,i=e),"key="+i+"&isMatch="+n}u.a_city=c.regMod("address",PluginsVersion.address,{name:"cityname",jsonpSource:g+"/Domestic/Tool/AjaxGetCitySuggestion.aspx",jsonpFilter:g+"/Domestic/Tool/AjaxIndexCityNew.aspx?keyword=${key}",isFocusNext:!1,isAutoCorrect:!1,delay:200,relate:{2:t("#HD_CityId"),0:t("#HD_CityPy")},message:{noFilterResult:"对不起，找不到：${$data.val}"},keyboard:{left:!1,right:!1},template:{padVersion:"2.0",suggestion:HD_HOTEL_CONFIG.tmpl.citySuggestion,suggestionIpad:HD_HOTEL_CONFIG.tmpl.citySuggestionIPad,suggestionStyle:HD_HOTEL_CONFIG.tmpl.citySuggestionStyle,suggestionStyleIpad:HD_HOTEL_CONFIG.tmpl.citySuggestionStyleIPad,filter:w,filterIpad:w,filterStyle:C,filterStyleIpad:C,filterPageSize:7,suggestionInit:function(e){u.defaultSuggestionInit(e),n(e)},suggestionInitIpad:function(e){u.a_city.get("defaultSuggestionInitIpad")(e),n(e)},filterInit:o,filterInitIpad:o}}),e.cityChange=i,u.a_city.method("bind","change",i);var s=!0;u.a_city.method("bind","userinput",function(e,n){function o(e){r(f),e||(m.value(""),m.attr("_lastvalue","")),l.value(""),l.attr("_lastvalue","")}function r(e){v.hotel.noExistCity&&u.formValidator.method("show",{$obj:c,data:v.hotel.noExistCity.replace("{city}",e),removeErrorClass:!0,isScroll:!1})}var l=t("#HD_CityId"),d=t("#HD_CityPy"),y=n.autoCorrectValue,h={searchType:null,cityId:l.value(),keyword:y};if("suggestionMousedown"===n.eventType&&(h.searchType="CTY_X",window.__bfi.push(["_tracklog","SEARCH_AUTOCOMPLET_US",t.stringifyJSON(h)])),("filterMousedown"===n.eventType||"keydown"===n.eventType)&&(h.searchType="CTY_BS",h.Yindex=n.target&&t(n.target).attr("data-yindex"),h.inputkeyword=n.value,h.fulldata=n.data,window.__bfi.push(["_tracklog","SEARCH_AUTOCOMPLET_US",t.stringifyJSON(h)])),this.value!=l.attr("_lastvalue")){if("suggestionMousedown"===n.eventType||"filterMousedown"===n.eventType||"keydown"===n.eventType&&(s||n.data))return s=!0,void window.__bfi.push(["_tracklog","nhtlcity",a(y,y,null)]);if("blur"===n.eventType&&s)return void window.__bfi.push(["_tracklog","nhtlcity",a(y,y,null)]);var m=t("#HD_CityName"),p=l.value()||"",_="";p.replace(/D(\d+)_(\d+)/,function(e,t,i){p=i,_="&itemId="+t});var f=m.value(),w=g+"/Domestic/Tool/AjaxIndexCityNew.aspx?keyword="+encodeURIComponent(escape(f));t.loader.jsonp(w,{charset:"gb2312",onload:function(e){var t=e.data,n=t.match(/[^@]+\|[^@]+/g);if(!n)return void o(!0);var c="";if(n&&n.length>0){var u=n[0].split("|");u.length>1&&(s=!0,c=u[1]?u[1]:"",m.value(c),m.attr("_lastvalue",c),l.value(u[2]?u[2]:""),l.attr("_lastvalue",l.value()),d.value(u[0]?u[0]:""),i(void 0,{items:u}),m.value()||r(f)),cQuery.jsonpResponse={}}else c="",o(!0);window.__bfi.push(["_tracklog","nhtlcity",a(t.key,c,null)])},onerror:o})}}),c.bind("focus",function(){D=!0}).bind("keyup",function(e){e=e||window.event;var t=e.keyCode;13==t?(s=!0,D?(u.a_city.method("validate"),T.submit()&&y.submit()):D=!0,e.preventDefault?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1):-1===[37,38,39,40].indexOf(t)&&(s=!1)}),window.chinaHotelSF=function(){u.a_city.method("focus",{isHidden:!0,isSelected:!0})},chinaHotelSF()}function s(e){function i(e){if(o.removeClass("inputSel"),document.getElementById("HD_CityName").value=unescape(e.cityname),document.getElementById("HD_CityId").value=e.id,document.getElementById("HD_CityPy").value=e.pingying,"false"===e.isoutdate){var i=t("#HD_CheckIn"),n=t("#HD_CheckOut");i.value(e.checkin),n.value(e.checkout),i[0].style.backgroundImage="",n[0].style.backgroundImage=""}cityChangeEvent(e.id,e.cityname)}if(e){var n=t("#HD_SearchHistory"),o=t("#HD_CityName");if(n.length){n[0].style.display="",o.parentNode().removeClass("w100").addClass("w05"),o.removeClass("w01").addClass("w06");for(var a=[],s=Math.min(3,e.length),r=0;s>r;r++){var c=e[r],l="true"===c.isoutdate?" item_past":"";a.push('<a href="javascript:;" class="history_item'+l+"\" data='"+t.stringifyJSON(c).replace(/'/g,"")+'\'><span class="city">'+unescape(c.cityname)+'</span><span class="date">'+c.checkin+" 至 "+c.checkout+"</span></a>")}n.find(".history_list").html(a.join("")),btn=n.find(".s_history_btn"),list=n.find(".history_list")[0],btn.bind("click",function(e){e.stop(),-1!=this.className.indexOf("s_history_btn_hover")?(this.className="s_history_btn",list.style.display="none"):(this.className="s_history_btn s_history_btn_hover",list.style.display="block")}),n.find(".history_item").bind("click",function(){var e=t.parseJSON(this.getAttribute("data"));i(e)}),t(document).bind("click",function(){btn[0].className="s_history_btn",list.style.display="none"})}}}function r(){}if(this.ops.city.length){var c=this.ops.city,d=this.ops.startDate,h=this.ops.endDate,p=this.ops.keyword,_=setTimeout(function(){a()},2e3),f=t.browser.isIPad;window.searchHistoryList="";var w=HD_HOTEL_CONFIG.tmpl.cityFilter,C=HD_HOTEL_CONFIG.tmpl.cityFilterStyle;t.getJsonp(g+"/Domestic/Tool/AjaxGetUserSearchBehavior.aspx",function(e){if(e){for(var i=Math.min(6,e.length),n=[],o=0;i>o;o++){var r=unescape(e[o].cityname).replace(/\(.*\)/,"");r=r.length>4?r.substr(0,4):r,n.push('<a href="javascript:;" title="'+unescape(e[o].cityname)+"\" data-history='"+t.stringifyJSON(e[o]).replace(/'/g,"")+"'>"+r+"</a>")}searchHistoryList='<p class="sarch_history_title">'+m.searchHistory+'</p><div class="search_history_box">'+n.join("")+"</div>",s(e)}u.a_city||(clearTimeout(_),a())})}window.cityChangeEvent=function(e,n){var o=u.a_keyword,a=t("#HD_CityName").value();o&&e&&i(o,e),D=!1;var s=c[0];s.value!=s.getAttribute("_lastValue")&&(s.setAttribute("_lastValue",s.value),u.n_keyword&&(p.attr("isFormCity")?p.attr("isFormCity",""):(u.n_keyword.method("resetValue"),t("#positionArea, #positionId, #hotelAreaName").value("")),a||o.set("source",{suggestion:null,data:"@@"}),e?window.getOtherDataByCity(e,n):r()))},window.getOtherDataByCity=function(e,t,i,n){if(e!==n){var o="error",a="";if(e>=1&&10>=e?(o="idFrom1To10",a="1_10"):e>=11&&200>=e?(o="idFrom11To200",a="11_200"):e>=201?(o="idFrom201ToMax",a="201_99999"):/D\d+_\d+/.test(e)&&"undefined"==typeof I[e]&&(I[e]={}),I.dataCash[o])r(e,t),i&&i();else;}},this.ops.keyword.length&&this.initKeyword()},initNotice:function(){this.ops.city.length&&(u.n_city=this.ops.city.regMod("notice",PluginsVersion.notice,{name:"city",tips:p[0],selClass:"inputSel"})),this.ops.startDate.length&&(u.n_startDate=this.ops.startDate.regMod("notice",PluginsVersion.notice,{name:"startDate",tips:"yyyy-mm-dd",selClass:"inputSel"})),this.ops.endDate.length&&(u.n_endDate=this.ops.endDate.regMod("notice",PluginsVersion.notice,{name:"endDate",tips:"yyyy-mm-dd",selClass:"inputSel"})),this.ops.checkInDate.length&&(u.n_checkInDate=this.ops.checkInDate.regMod("notice",PluginsVersion.notice,{name:"checkInDate",tips:"yyyy-mm-dd",selClass:"inputSel"})),this.ops.checkOutDate.length&&(u.n_checkOutDate=this.ops.checkOutDate.regMod("notice",PluginsVersion.notice,{name:"checkOutDate",tips:"yyyy-mm-dd",selClass:"inputSel"}))},initCalendar:function(e,t){e.regMod("calendar",PluginsVersion.calendar,{options:{showWeek:!0,container:cQuery.container}}),t.regMod("calendar",PluginsVersion.calendar,{options:{showWeek:!0,reference:"#"+e[0].id,minDate:e.value().toDate()?e.value().toDate().addDays(1).toStdDateString():(new Date).addDays(1).toStdDateString()}}),e.bind("change",function(e){e=e||window.event;var i=e.target||e.srcElement||e.host;if(i){var n=i.value.toDate();if(n){var o=n.addDays(1);t.data("minDate",o.toStdDateString());var a=t.value().toDate();(!a||n>=a)&&(t.value(o.toFormatString("yyyy-MM-dd")),t.getMod("notice",PluginsVersion.notice).method("checkValue"),t.getMod("calendar",PluginsVersion.calendar).method("setWeek","#"+t[0].id)),a&&a-n>h&&setTimeout(function(){u.formValidator.method("show",{$obj:t,data:v.hotel.too_long,removeErrorClass:!0,isScroll:!1})}.bind(this),0),t[0].focus()}else t.data("minDate",(new Date).addDays(1).toStdDateString())}}.bind(this)).bind("focus",function(){this.timer&&clearTimeout(this.timer)}.bind(this)),t.bind("focus",function(i){i=i||window.event;var n=i.target||i.srcElement||i.host,o=e.value().toDate(),a=n.value.toDate();o&&a&&a-o>h&&setTimeout(function(){u.formValidator.method("show",{$obj:t,data:v.hotel.too_long,removeErrorClass:!0,isScroll:!1})}.bind(this),0)}.bind(this)).bind("blur",function(){this.timer=setTimeout(function(){var i=e.value().toDate(),n=t.value().toDate();i&&n&&n>i&&n-i>h&&u.formValidator.method("show",{$obj:t,data:v.hotel.too_long,removeErrorClass:!0,isScroll:!1})}.bind(this),100)}.bind(this))}}),e.RegMod=C}(window,cQuery),e.extend(cQuery,{replace:function(e,t){return e.replace(/\$\{([\w\.?]+)\}/g,function(e,i){var n=i.split("."),o=n.length,a=n[0];if(o>1){for(var s=t,r=0;o>r;r++){if(!(a in s))return e;s=s[a],a=n[r+1]}return s}return a in t?t[a]:e})},format:function(e){var t=arguments,i=t.length;return i>1?e.replace(/\$(\d)/g,function(e,i){return void 0==t[i]?"":t[i]}):e},create:function(e,t){var i=document.createElement(e);for(var n in t)t.hasOwnProperty(n)&&("cssText"==n?i.style[n]=t[n]:i[n]=t[n]);return i}});var C=function(e,t){this.events={},e&&e.call(this,t)};e.extend(C.prototype,{set:function(){},get:function(){return null},evt:function(e,t){this.events[e]=t},init:function(){}});var T=new C(function(){function i(t,i){return t.focus(),setTimeout(function(){u.formValidator.method("show",{$obj:e(t),data:v.hotel[i],removeErrorClass:!0,hideEvent:"blur",isScroll:!1})},50),!1}var n,o,a,s,r,c,l={isAuto:!1,isMap:!1};this.init=function(){n=document.getElementById("HD_CheckIn"),o=document.getElementById("HD_CheckOut"),a=document.getElementById("HD_CityName"),s=document.getElementById("HD_TxtKeyword"),r=document.getElementById("HD_CityId"),c=document.getElementById("HD_CityPy");var t=e("#chinaHotelForm");t.bind("keydown",function(e){e=e||window.event,13==e.keyCode&&T.submit()&&y.submit()})},this.set=function(){},this.checkDate=function(t,n){n=n?n.toDate():(new Date).toStdDateString().toDate();var o=t[0],a=t[1],s=o.value.toDate()||0,r=a.value.toDate()||0;return e(o).value()?s?n>s?i(o,"too_early_in"):e(a).value()?r?s>=r?i(a,"too_early_out"):r-s>h?i(a,"too_long"):1:i(a,"dateErr"):i(a,"checkOut"):i(o,"dateErr"):i(o,"checkIn")},this.checkDateByAuto=function(t,i){i=i?i.toDate():(new Date).toStdDateString().toDate();var n=t[0],o=t[1],a=n.value.toDate()||0,s=o.value.toDate()||0;return e(n).value()&&a?i>a?0:e(o).value()&&s?a>=s?0:s-a>h?0:1:0:0},this.setSubmit=function(e,t){l.isAuto=!!e,l.isMap=!!t},this.submit=function(u,d){if(u=u||l.isAuto,d=d||l.isMap,!e(r).value()){if(!u)return i(a,"city");var h={cityId:"",cityName:"",cityPY:""};h.cityId&&h.cityName&&h.cityPY?(a.value=h.cityName,r.value=h.cityId,c.value=h.cityPY):(a.value=m.defaultValue[0],r.value=m.defaultValue[1],c.value=m.defaultValue[2])}if(u)this.checkDateByAuto([n,o])||(n.value=n.defaultValue,o.value=o.defaultValue);else if(!this.checkDate([n,o]))return!1;var v,p,_=[],f="",w=e("#positionArea")[0],I=e("#positionId")[0],D=e("#hotelAreaName")[0],C=e(s).value();!function(){if(C){var e=I.value,t=w.value;p="hotel"===t.toLowerCase(),v=markerTypeMap[t.toLowerCase()],v=v&&v.search,v?"district"!==v&&("s"===v&&(e=e.replace(/^[SL]/,"")),f+=v+e):D.value=C}else w.value="",I.value="",D.value=""}();var k=document.getElementById("searchHotelLevelSelect");k&&"0"!=k.value&&(f+="star"+k.value),f&&_.push(f),e(s).value()&&!v&&_.push((p?"k2":"k1")+encodeURIComponent(D.value.replace(/\+/g,"＋")));var T="/hotel/${city}${map}${other}";w.value&&"hotel"===w.value.toLowerCase()&&I.value&&(T="/hotel/"+I.value+".html");var b=e.replace(T,{city:c.value.toLowerCase()+""+r.value,map:d?"/map":"",other:_.length?"/"+_.join("/"):""});return e("#HD_CheckIn").value(n.value),e("#HD_CheckOut").value(o.value),y.action=g+b+"#ctm_ref=ctr_hp_sb_lst",y.__VIEWSTATE&&(y.__VIEWSTATE.name="NOVIEWSTATE"),y.target="_self",t&&t(),!0},this.setCity=function(e,t,i){e&&t&&i&&u.n_city.method("checkValue")}}),b="HotelCityID",E={cityName:"HD_CityName",cityId:"HD_CityId",cityPY:"HD_CityPy",checkIn:"HD_CheckIn",checkOut:"HD_CheckOut",hotellevel:"searchHotelLevelSelect"},H={cityId:"cityId",cityName:"cityName",cityPY:"cityPY",checkIn:"checkIn",checkOut:"checkOut",hotellevel:"hotellevel"},S=function(){var t=(e("#_releaseNo_").value(),c(b,H));t=cQuery.extend({cityName:"",cityId:"",cityPY:"",checkIn:"",checkOut:"",hotellevel:""},t),n(E,t),document.getElementById("HD_TxtKeyword").value="",document.getElementById("hotelAreaName").value="";var i=function(){new RegMod({city:e("#HD_CityName"),startDate:e("#HD_CheckIn"),endDate:e("#HD_CheckOut"),keyword:e("#HD_TxtKeyword")})},o=function(){T.init(),T.setCity(t.cityId,t.cityName,t.cityPY),setKeywordJsonpUrl(u.a_keyword,t.cityId),e("#HD_Btn").bind("click",function(t){var i=e(this),n="s_btn_ing";i.removeClass(n).value(d.srhLoad),T.submit()&&(i.addClass(n).value(d.srhLoading),w(),y.submit()),t.stop()}),e("#HD_MapBtn").bind("click",function(e){T.submit(!1,!0)&&(w(),y.submit()),e.stop()})},a=function(){i(),o()};return{init:a}}();S.init()}(cQuery),cQuery.BizMod=cQuery.BizMod||{},function(e){var t,i=function(){},n=/big5\./.test(location.host),o=$.extend,a={geolocationError:i,geolocationConfig:{enableHighAccuracy:!0,timeout:5e3,maximumAge:864e5},geolocationToCityService:"/test.ajax",cityId:$("#cityId"),cityName:$("#txtCity"),cityPY:$("#cityPY")};t={getGeolocation:function(e,t,i){return navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t||a.geolocationError,i||a.geolocationConfig):e(null),this},getCityByGeolocation:function(e,t){var i=this;return i.getGeolocation(function(o){var s=o.coords||{};$.ajax((t||a.geolocationToCityService)+"?isBig5="+n+"&lat="+s.latitude+"&lon="+s.longitude,{method:$.AJAX_METHOD_GET,onsuccess:function(t,n){n=n&&$.parseJSON(n),e.call(i,n)}})}),i},setCity:function(e){var t=a,i=t.cityName,n=e.id;n&&(t.cityId.value(n),i.value(e.name),t.cityPY.value(e.py),i.removeClass("inputSel"))},init:function(e){return o(a,e),this}},t.init({geolocationToCityService:"/ajax.url"}),e.SearchPanel=t}(cQuery.BizMod,window);